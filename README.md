# Advanced Patch Generator

[![npm version](https://badge.fury.io/js/advanced-patch-generator.svg)](https://badge.fury.io/js/advanced-patch-generator)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js CI](https://github.com/seuusuario/advanced-patch-generator/workflows/Node.js%20CI/badge.svg)](https://github.com/seuusuario/advanced-patch-generator/actions)

Gerenciador de patch avan√ßado usando Xdelta para criar e aplicar patches de forma eficiente. Ideal para distribui√ß√£o de atualiza√ß√µes de software, controle de vers√£o de arquivos bin√°rios e otimiza√ß√£o de transfer√™ncia de dados.

## üöÄ Caracter√≠sticas

- ‚úÖ **Cria√ß√£o de patches** usando Xdelta3 com alta compress√£o
- ‚úÖ **Aplica√ß√£o de patches** com verifica√ß√£o autom√°tica de integridade
- ‚úÖ **Suporte multiplataforma** (Windows, Linux, macOS)
- ‚úÖ **Processamento em lote** para m√∫ltiplos arquivos
- ‚úÖ **M√©tricas detalhadas** de compress√£o e performance
- ‚úÖ **An√°lise avan√ßada de patches** com diferentes n√≠veis de compress√£o
- ‚úÖ **Verifica√ß√£o de integridade** para garantir precis√£o
- ‚úÖ **Otimiza√ß√µes para arquivos grandes** com processamento inteligente
- ‚úÖ **Interface simples** e intuitiva
- ‚úÖ **Documenta√ß√£o completa** com exemplos pr√°ticos

## üìã Pr√©-requisitos

### Instala√ß√£o do Xdelta3

**M√©todo Autom√°tico (Recomendado):**
```bash
# Usando o script de instala√ß√£o
npm run install:xdelta3
```

**M√©todo Manual:**

**Windows:**
```bash
# Usando Scoop
scoop install xdelta3

# Usando Chocolatey
choco install xdelta3

# Usando Winget
winget install xdelta3

# Ou download manual
# 1. Acesse: https://github.com/jmacd/xdelta/releases
# 2. Baixe a vers√£o mais recente para Windows
# 3. Extraia o arquivo xdelta3.exe
# 4. Coloque em uma pasta no PATH (ex: C:\Windows\System32\)
```

**Linux:**
```bash
sudo apt-get install xdelta3
# ou
sudo yum install xdelta3
```

**macOS:**
```bash
brew install xdelta3
```

## üì¶ Instala√ß√£o

```bash
npm install advanced-patch-generator
```

## üèóÔ∏è Estrutura do Projeto

O projeto foi reorganizado para melhor separa√ß√£o de responsabilidades:

```
src/
‚îú‚îÄ‚îÄ constants/          # Constantes e configura√ß√µes
‚îú‚îÄ‚îÄ lib/               # Bibliotecas principais
‚îú‚îÄ‚îÄ utils/             # Utilit√°rios reutiliz√°veis
‚îú‚îÄ‚îÄ validations/       # Valida√ß√µes de entrada
‚îî‚îÄ‚îÄ index.js           # Ponto de entrada principal
```

### M√≥dulos Dispon√≠veis

- **`AdvancedPatchGenerator`**: Classe principal para gerenciamento de patches
- **`MetricsUtils`**: Utilit√°rios para formata√ß√£o de m√©tricas e tempo
- **`CommandUtils`**: Utilit√°rios para execu√ß√£o de comandos
- **`DisplayUtils`**: Utilit√°rios para exibi√ß√£o e formata√ß√£o
- **`FileValidation`**: Valida√ß√µes de arquivos e caminhos
- **Constantes**: Configura√ß√µes padr√£o e mensagens

## üß™ Uso R√°pido

### Teste Inicial

1. **Clone o reposit√≥rio:**
   ```bash
   git clone https://github.com/seuusuario/advanced-patch-generator.git
   cd advanced-patch-generator
   npm install
   ```

### Teste para Arquivos Grandes

Para arquivos grandes (>100MB), use o teste espec√≠fico:

```bash
npm run test:large
```

Este teste aplica otimiza√ß√µes autom√°ticas para arquivos grandes, incluindo:
- Compress√£o reduzida para melhor performance
- Verifica√ß√£o opcional para economizar mem√≥ria
- Timeouts aumentados
- Processamento em streaming

2. **Coloque seus arquivos:**
   - Arquivo original em `files/old/`
   - Arquivo atualizado em `files/new/`

3. **Execute o teste:**
   ```bash
   npm test
   ```

4. **Veja os exemplos da nova estrutura:**
   ```bash
   node examples/usage-examples.js
   ```

### Uso Program√°tico

#### Importa√ß√£o Principal
```javascript
import AdvancedPatchGenerator from 'advanced-patch-generator';

// Inicializar com configura√ß√µes personalizadas
const patchGen = new AdvancedPatchGenerator({
  compression: 6,
  verify: true,
  showProgress: true
});

// Criar patch
const result = await patchGen.createPatch(
  'arquivo_antigo.txt',
  'arquivo_novo.txt',
  'patch.xdelta'
);

console.log(`Patch criado: ${result.patch.sizeFormatted}`);
console.log(`Taxa de compress√£o: ${result.compression.ratio}%`);

// Aplicar patch
await patchGen.applyPatch(
  'arquivo_antigo.txt',
  'patch.xdelta',
  'arquivo_aplicado.txt'
);

// Verificar integridade
const verification = await patchGen.verifyPatch(
  'arquivo_antigo.txt',
  'patch.xdelta',
  'arquivo_novo.txt'
);

console.log(`Patch v√°lido: ${verification.isValid}`);
```

#### Importa√ß√£o Espec√≠fica de M√≥dulos
```javascript
import { AdvancedPatchGenerator } from 'advanced-patch-generator/lib';
import { MetricsUtils, DisplayUtils } from 'advanced-patch-generator/utils';
import { FileValidation } from 'advanced-patch-generator/validations';
import { DEFAULT_OPTIONS } from 'advanced-patch-generator/constants';

// Usar utilit√°rios diretamente
const bytesFormatados = MetricsUtils.formatBytes(1048576); // "1 MB"
const tempoFormatado = MetricsUtils.formatTime(1500); // "1.50s"

// Usar valida√ß√µes
const nivelValido = FileValidation.isValidCompressionLevel(5); // true
```

## üìö API Completa

### Construtor

```javascript
new AdvancedPatchGenerator(options)
```

**Op√ß√µes:**
- `xdeltaPath` (string): Caminho para o execut√°vel xdelta3
- `compression` (number): N√≠vel de compress√£o (0-9, padr√£o: 9)
- `verify` (boolean): Verificar integridade (padr√£o: true)
- `showProgress` (boolean): Mostrar progresso (padr√£o: true)

### M√©todos Principais

#### `createPatch(oldFile, newFile, patchFile, options)`

Cria um patch entre dois arquivos.

```javascript
const result = await patchGen.createPatch(
  'old/file.txt',
  'new/file.txt',
  'patch.xdelta',
  { compression: 6 }
);

// Resultado:
{
  success: true,
  patchFile: 'patch.xdelta',
  duration: 150,
  durationFormatted: '150ms',
  oldFile: { path: 'old/file.txt', size: 1024, sizeFormatted: '1 KB' },
  newFile: { path: 'new/file.txt', size: 2048, sizeFormatted: '2 KB' },
  patch: { path: 'patch.xdelta', size: 512, sizeFormatted: '512 Bytes' },
  compression: {
    ratio: '75.00',
    level: 6,
    originalSize: 2048,
    compressedSize: 512
  }
}
```

#### `applyPatch(oldFile, patchFile, newFile, options)`

Aplica um patch a um arquivo.

```javascript
const result = await patchGen.applyPatch(
  'old/file.txt',
  'patch.xdelta',
  'applied/file.txt'
);

// Resultado:
{
  success: true,
  newFile: 'applied/file.txt',
  duration: 100,
  durationFormatted: '100ms',
  oldFile: { path: 'old/file.txt', size: 1024, sizeFormatted: '1 KB' },
  patch: { path: 'patch.xdelta', size: 512, sizeFormatted: '512 Bytes' },
  appliedFile: { path: 'applied/file.txt', size: 2048, sizeFormatted: '2 KB' }
}
```

#### `verifyPatch(oldFile, patchFile, newFile)`

Verifica a integridade de um patch.

```javascript
const verification = await patchGen.verifyPatch(
  'old/file.txt',
  'patch.xdelta',
  'new/file.txt'
);

// Resultado:
{
  isValid: true,
  originalSize: 2048,
  patchedSize: 2048
}
```

#### `createBatchPatches(oldDir, newDir, patchesDir, options)`

Cria patches em lote para m√∫ltiplos arquivos.

```javascript
const patches = await patchGen.createBatchPatches(
  'files/old/',
  'files/new/',
  'files/patches/'
);

// Resultado:
[
  { file: 'file1.txt', patchPath: 'files/patches/file1.txt.xdelta', status: 'success' },
  { file: 'file2.txt', patchPath: 'files/patches/file2.txt.xdelta', status: 'success' }
]
```

#### `applyBatchPatches(oldDir, patchesDir, outputDir, options)`

Aplica patches em lote.

```javascript
const results = await patchGen.applyBatchPatches(
  'files/old/',
  'files/patches/',
  'files/applied/'
);

// Resultado:
[
  { file: 'file1.txt', status: 'success' },
  { file: 'file2.txt', status: 'success' }
]
```

### Configura√ß√µes para Arquivos Grandes

Para arquivos grandes (>100MB), use configura√ß√µes otimizadas:

```javascript
import AdvancedPatchGenerator from './src/lib/AdvancedPatchGenerator.js';

const patchGen = new AdvancedPatchGenerator({
  compression: 3, // Compress√£o baixa para arquivos grandes
  verify: false, // Pula verifica√ß√£o para economizar mem√≥ria
  largeFileThreshold: 50 * 1024 * 1024, // 50MB
  timeout: 900000, // 15 minutos
  memoryLimit: 256 * 1024 * 1024 // 256MB
});

// Verificar se √© arquivo grande
import LargeFileUtils from './src/utils/largeFileUtils.js';

const fileSize = await LargeFileUtils.getFileSize('arquivo.grf');
const isLarge = await LargeFileUtils.isLargeFile('arquivo.grf');

if (isLarge) {
  console.log('Arquivo grande detectado. Aplicando otimiza√ß√µes...');
}
```

### An√°lise Avan√ßada de Patches

O `PatchAnalyzer` permite analisar patches com diferentes n√≠veis de compress√£o para encontrar a melhor configura√ß√£o para seus arquivos.

#### `analyzePatch(oldFile, newFile, outputDir, options)`

Analisa patches com diferentes n√≠veis de compress√£o.

```javascript
import { PatchAnalyzer } from 'advanced-patch-generator';

const analyzer = new PatchAnalyzer({
  showProgress: true,
  includeUncompressed: true,
  compressionLevels: [0, 1, 3, 6, 9]
});

const results = await analyzer.analyzePatch(
  'files/old/exemplo.txt',
  'files/new/exemplo.txt',
  'files/patches/analysis'
);

// Exibe resultados de forma bonita
PatchAnalyzer.displayAnalysisResults(results);
```

**Resultado da an√°lise:**
```javascript
{
  oldFile: { path: 'files/old/exemplo.txt', size: 1024, sizeFormatted: '1 KB' },
  newFile: { path: 'files/new/exemplo.txt', size: 2048, sizeFormatted: '2 KB' },
  analysis: [
    {
      testName: 'uncompressed',
      compressionLevel: -1,
      patchFile: 'files/patches/analysis/patch_uncompressed.xdelta',
      patchInfo: { size: 1024, sizeFormatted: '1 KB' },
      duration: 50,
      durationFormatted: '50ms',
      success: true,
      compressionRatio: 50.00,
      sizeSaved: 1024,
      sizeSavedFormatted: '1 KB'
    },
    // ... outros n√≠veis de compress√£o
  ],
  summary: {
    totalTests: 6,
    successfulTests: 6,
    bestCompression: { /* melhor resultado */ },
    worstCompression: { /* pior resultado */ },
    averageCompressionRatio: '75.50',
    totalSizeSaved: 6144,
    totalSizeSavedFormatted: '6 KB'
  },
  duration: 500,
  durationFormatted: '500ms'
}
```

#### Comando CLI para An√°lise

```bash
# An√°lise b√°sica
node scripts/analyze-patches.js files/old/file.txt files/new/file.txt

# An√°lise com n√≠veis espec√≠ficos
node scripts/analyze-patches.js old.txt new.txt --compression 0,3,9

# An√°lise sem teste sem compress√£o
node scripts/analyze-patches.js old.txt new.txt --no-uncompressed

# An√°lise com diret√≥rio de sa√≠da personalizado
node scripts/analyze-patches.js old.txt new.txt --output-dir ./my-patches

# Ver ajuda
node scripts/analyze-patches.js --help
```

### M√©todos Principais

#### `checkXdelta()`

Verifica se o Xdelta3 est√° dispon√≠vel no sistema.

```javascript
try {
  await patchGen.checkXdelta();
  console.log('‚úÖ Xdelta3 encontrado!');
} catch (error) {
  console.log('‚ùå Xdelta3 n√£o encontrado:', error.message);
}
```

## üìÅ Estrutura do Projeto

```
advanced-patch-generator/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ index.js          # Biblioteca principal
‚îú‚îÄ‚îÄ files/
‚îÇ   ‚îú‚îÄ‚îÄ old/              # Arquivos originais
‚îÇ   ‚îú‚îÄ‚îÄ new/              # Arquivos atualizados
‚îÇ   ‚îú‚îÄ‚îÄ patches/          # Patches gerados
‚îÇ   ‚îî‚îÄ‚îÄ applyPatches/     # Arquivos com patch aplicado
‚îú‚îÄ‚îÄ test.js               # Arquivo de teste
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .eslintrc.json        # Configura√ß√£o ESLint
‚îî‚îÄ‚îÄ README.md
```

## üîß Configura√ß√£o Avan√ßada

### Op√ß√µes de Compress√£o

```javascript
const patchGen = new AdvancedPatchGenerator({
  compression: 9,        // M√°xima compress√£o (0-9)
  verify: true,          // Verificar integridade
  showProgress: true,    // Mostrar progresso
  xdeltaPath: '/usr/bin/xdelta3'  // Caminho personalizado
});
```

### Processamento em Lote

```javascript
// Criar patches para todos os arquivos
const patches = await patchGen.createBatchPatches(
  'files/old/',
  'files/new/',
  'files/patches/',
  { compression: 6 }
);

// Aplicar todos os patches
const results = await patchGen.applyBatchPatches(
  'files/old/',
  'files/patches/',
  'files/applied/'
);
```

## üìä M√©tricas e Performance

O sistema fornece m√©tricas detalhadas:

- **Tamanho dos arquivos** (original, novo, patch)
- **Taxa de compress√£o** (%)
- **Tempo de processamento**
- **Verifica√ß√£o de integridade**
- **Progresso em tempo real**

## üõ†Ô∏è Comandos Dispon√≠veis

```bash
npm test          # Executar teste
npm start         # Executar biblioteca
npm run lint      # Verificar c√≥digo
npm run lint:fix  # Corrigir problemas de linting
npm run docs      # Gerar documenta√ß√£o
```

## üìù Exemplo de Sa√≠da

```
üß™ Teste do Advanced Patch Generator
=====================================

üîç Verificando Xdelta3...
‚úÖ Xdelta3 encontrado e funcionando!

üìÅ Diret√≥rios criados:
   - files/old/ (arquivos originais)
   - files/new/ (arquivos atualizados)
   - files/patches/ (patches gerados)
   - files/applyPatches/ (arquivos com patch aplicado)

üîÑ Arquivos que ser√£o testados: exemplo.txt

==================================================
üß™ Testando: exemplo.txt
==================================================

üì¶ Criando patch...
‚úÖ Patch criado com sucesso!

üîß Aplicando patch...
‚úÖ Patch aplicado com sucesso!

üîç Verificando integridade...
‚úÖ Patch √© v√°lido!

==================================================
üìä RESULTADOS FINAIS
==================================================
‚úÖ Testes bem-sucedidos: 1/1
üìà Taxa de sucesso: 100.0%

üéâ Todos os testes passaram! O sistema est√° funcionando perfeitamente.
```

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Por favor, leia as diretrizes antes de contribuir.

### Como Contribuir

1. **Fork o projeto**
2. **Crie uma branch para sua feature**
   ```bash
   git checkout -b feature/AmazingFeature
   ```
3. **Commit suas mudan√ßas**
   ```bash
   git commit -m 'Add some AmazingFeature'
   ```
4. **Push para a branch**
   ```bash
   git push origin feature/AmazingFeature
   ```
5. **Abra um Pull Request**

### Diretrizes de Contribui√ß√£o

- Mantenha o c√≥digo limpo e bem documentado
- Adicione testes para novas funcionalidades
- Siga as conven√ß√µes de c√≥digo existentes
- Atualize a documenta√ß√£o quando necess√°rio

## üêõ Reportando Bugs

Se voc√™ encontrar um bug, por favor:

1. Verifique se o bug j√° foi reportado
2. Crie uma issue com informa√ß√µes detalhadas
3. Inclua passos para reproduzir o problema
4. Adicione informa√ß√µes do sistema (OS, Node.js version, etc.)

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üôè Agradecimentos

- [Xdelta](https://github.com/jmacd/xdelta) - Biblioteca de delta encoding
- [fs-extra](https://github.com/jprichardson/node-fs-extra) - Utilit√°rios de sistema de arquivos

## üìû Suporte

- üìß Email: seu.email@exemplo.com
- üêõ Issues: [GitHub Issues](https://github.com/seuusuario/advanced-patch-generator/issues)
- üìñ Documenta√ß√£o: [GitHub Wiki](https://github.com/seuusuario/advanced-patch-generator/wiki)
#   A d v a n c e d - P a t c h - G e n e r a t o r 
 
 